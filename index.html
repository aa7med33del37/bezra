<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Runner Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#87CEEB, #ffffff);
  }
  canvas { display: block; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* =====================
   Canvas
===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* =====================
   Assets
===================== */
const playerImg = new Image();
playerImg.src = "player.png";

/* =====================
   Game Vars
===================== */
const groundHeight = 40;
let gravity = 0.7;
let speed = 6;
let score = 0;
let gameOver = false;

/* =====================
   Player (Professional)
===================== */
const player = {
  x: 100,
  y: 0,           // يتحسب تلقائي
  w: 80,
  h: 120,
  dy: 0,
  jump: -16,
  grounded: false,

  // Hitbox أصغر من الصورة
  hit: {
    offsetX: 20,
    offsetY: 20,
    w: 40,
    h: 90
  }
};

/* =====================
   Obstacles
===================== */
let obstacles = [];

function spawnObstacle(){
  obstacles.push({
    x: canvas.width,
    y: canvas.height - groundHeight - 60,
    w: 40,
    h: 60
  });
}
setInterval(spawnObstacle, 1700);

/* =====================
   Update
===================== */
function update(){
  if (gameOver) return;

  player.dy += gravity;
  player.y += player.dy;

  // Ground anchor (من الرجل)
  const groundY = canvas.height - groundHeight;
  if (player.y + player.h >= groundY) {
    player.y = groundY - player.h;
    player.dy = 0;
    player.grounded = true;
  }

  obstacles.forEach(o => o.x -= speed);
  obstacles = obstacles.filter(o => o.x + o.w > 0);

  // Collision using hitbox
  obstacles.forEach(o => {
    if (
      player.x + player.hit.offsetX < o.x + o.w &&
      player.x + player.hit.offsetX + player.hit.w > o.x &&
      player.y + player.hit.offsetY < o.y + o.h &&
      player.y + player.hit.offsetY + player.hit.h > o.y
    ) {
      gameOver = true;

setTimeout(() => {
  resetGame();
}, 1000);

    }
  });

  score++;
  speed += 0.0007;
}

/* =====================
   Draw
===================== */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ground
  ctx.fillStyle = "#4CAF50";
  ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);

  // Shadow (احترافي)
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.beginPath();
  ctx.ellipse(
    player.x + player.w/2,
    canvas.height - groundHeight + 5,
    player.w/3,
    8,
    0,0,Math.PI*2
  );
  ctx.fill();

  // Player Image (Bottom anchored)
  ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);

  // Obstacles
  ctx.fillStyle = "#8B0000";
  obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));

  // Score
  ctx.fillStyle = "#000";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 20, 30);

  if (gameOver) {
    ctx.font = "40px Arial";
    ctx.fillText("بذرة العرص خسر ...", canvas.width/2 - 110, canvas.height/2);
  }
}

/* =====================
   Loop
===================== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* =====================
   Controls
===================== */
addEventListener("click", jump);
addEventListener("touchstart", jump);

function jump(){
  if (player.grounded && !gameOver){
    player.dy = player.jump;
    player.grounded = false;
  }
}
  function resetGame(){
  gameOver = false;
  score = 0;
  speed = 6;

  player.y = 0;
  player.dy = 0;
  player.grounded = false;

  obstacles = [];
}

</script>

</body>
</html>

